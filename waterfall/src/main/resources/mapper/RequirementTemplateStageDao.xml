<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.theone.tools.waterfall.dao.RequirementTemplateStageDao">

    <resultMap id="BaseResultMap" type="com.theone.tools.waterfall.entity.RequirementTemplateStageEntity">
        <!--@Table requirement_template_stage-->
        <result property="id" column="id" jdbcType="INTEGER"/>
        <result property="templateId" column="template_id" jdbcType="INTEGER"/>
        <result property="name" column="name" jdbcType="VARCHAR"/>
        <result property="stageDesc" column="stage_desc" jdbcType="VARCHAR"/>
        <result property="stageType" column="stage_type"/>
        <result property="stageOrder" column="stage_order" jdbcType="INTEGER"/>
        <result property="requiredGroup" column="required_group"/>
        <result property="director" column="director" jdbcType="VARCHAR"/>
        <result property="updateTime" column="update_time" jdbcType="TIMESTAMP"/>
        <result property="createTime" column="create_time" jdbcType="TIMESTAMP"/>
    </resultMap>

    <!--查询单个-->
    <select id="queryById" resultMap="BaseResultMap">
        select id,
               template_id,
               name,
               stage_desc,
               stage_type,
               stage_order,
               required_group,
               director,
               update_time,
               create_time
        from waterfall.requirement_template_stage
        where id = #{id}
    </select>

    <!--查询指定行数据-->
    <select id="queryAllByLimit" resultMap="BaseResultMap">
        select id,
               template_id,
               name,
               stage_desc,
               stage_type,
               stage_order,
               required_group,
               director,
               update_time,
               create_time
        from waterfall.requirement_template_stage
        limit #{offset}, #{limit}
    </select>

    <!--通过实体作为筛选条件查询-->
    <select id="queryAll" resultMap="BaseResultMap">
        select
        id, template_id, name, stage_desc,stage_type, stage_order, required_group, director, update_time, create_time
        from waterfall.requirement_template_stage
        <where>
            <if test="id != null">
                and id = #{id}
            </if>
            <if test="templateId != null">
                and template_id = #{templateId}
            </if>
            <if test="name != null and name != ''">
                and name = #{name}
            </if>
            <if test="stageDesc != null and stageDesc != ''">
                and stage_desc = #{stageDesc}
            </if>
            <if test="stageType != null">
                and stage_type = #{stageType}
            </if>
            <if test="stageOrder != null">
                and stage_order = #{stageOrder}
            </if>
            <if test="requiredGroup != null">
                and required_group = #{requiredGroup}
            </if>
            <if test="director != null and director != ''">
                and director = #{director}
            </if>
        </where>
    </select>

    <!--新增所有列-->
    <insert id="insert" keyProperty="id" useGeneratedKeys="true">
        insert into waterfall.requirement_template_stage(template_id, name, stage_desc,stage_type, stage_order, required_group, director)
        values (#{templateId}, #{name}, #{stageDesc},#{stageType}, #{stageOrder}, #{requiredGroup}, #{director})
    </insert>

    <insert id="insertAll">
        insert into waterfall.requirement_template_stage(template_id, name, stage_desc,stage_type, stage_order,
        required_group,director)
        values
        <foreach open="(" close=")" collection="stages" item="stage" index="index" separator=",">
            #{templateId},
            #{stage.name},
            #{stage.stageDesc},
            #{stage.stageType},
            #{stage.stageOrder},
            #{stage.requiredGroup},
            #{stage.director}
        </foreach>
    </insert>

    <!--通过主键修改数据-->
    <update id="update">
        update waterfall.requirement_template_stage
        <set>
            <if test="templateId != null">
                template_id = #{templateId},
            </if>
            <if test="name != null and name != ''">
                name = #{name},
            </if>
            <if test="stageDesc != null and stageDesc != ''">
                stage_desc = #{stageDesc},
            </if>
            <if test="stageType != null and stageType != ''">
                stage_type = #{stageType},
            </if>s
            <if test="stageOrder != null">
                stage_order = #{stageOrder},
            </if>
            <if test="requiredGroup != null">
                required_group = #{requiredGroup},
            </if>
            <if test="director != null and director != ''">
                director = #{director},
            </if>
        </set>
        where id = #{id}
    </update>

    <!--通过主键删除-->
    <delete id="deleteById">
        delete
        from waterfall.requirement_template_stage
        where id = #{id}
    </delete>

    <delete id="deleteByTemplate">
        delete
        from waterfall.requirement_template_stage
        where template_id = #{templateId}
    </delete>
</mapper>